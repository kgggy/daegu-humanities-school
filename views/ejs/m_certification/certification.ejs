<style>
    .userTable thead tr .sorting:first-child::before,
    .userTable thead tr .sorting_asc:first-child::before,
    .userTable thead tr .sorting_asc:first-child::after,
    .userTable thead .sorting_desc:first-child:after,
    .userTable thead .sorting:first-child:after,
    .userTable thead .sorting:first-child {
        content: none !important;
        cursor: unset
    }
</style>
<main class="main">
    <!-- Breadcrumb-->
    <ol class="breadcrumb">
        <li class="breadcrumb-item">Home</li>
        <li class="breadcrumb-item">
            <% if(certiDivision == 0) { %>
            <a style="font-weight: bold;">탄소실천관리</a>
            <% } else {%>
            <a style="font-weight: bold;">챌린지관리</a>
            <% } %>
        <li class="breadcrumb-item active">종류관리</li>
    </ol>

    <div class="container-fluid">
        <div class="animated fadeIn">
            <div class="row">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <% if(certiDivision == 0) { %>
                            <i class="fa fa-align-justify"></i> 탄소실천 종류 관리
                            <% } else {%>
                            <i class="fa fa-align-justify"></i> 챌린지 종류 관리
                            <% } %>
                        </div>
                        <div class="card-body">
                            <form id="certiForm" name="certiForm" method="get"
                                action="/admin/m_certification/certiWritForm">
                                <div class="certiSearch" style="display: flex; justify-content: end; gap: 5px;">
                                    <input type="hidden" id="page" name="page" value="" />
                                    <input type="hidden" id="certiDivision" name="certiDivision" value="<%= certiDivision %>" />
                                    <% if(certiDivision == 0) { %>
                                    <select id="division" name="division" class="dropdown">
                                        <option value="" selected="selected">--분류--</option>
                                        <% for(var i = 0; i < div.length ; i++){  %>
                                        <option value="<%= div[i].certiSubDivision %>"
                                            <%if(division==div[i].certiSubDivision){%> selected="selected"
                                            <%}%>><%= div[i].certiSubDivision %></option> <% } %> </select> <select
                                            name="searchType" class="dropdown">
                                        <option value="" selected="selected">--단계--</option>
                                        <option value="1" <%if(searchType=="1"){%> selected="selected" <%}%>>1단계</option>
                                    <option value="2" <%if(searchType=="2"){%> selected="selected" <%}%>>2단계</option>
                                    <option value="3" <%if(searchType=="3"){%> selected="selected" <%}%>>3단계</option>
                                    <option value="4" <%if(searchType=="4"){%> selected="selected" <%}%>>4단계</option>
                                    <option value="5" <%if(searchType=="5"){%> selected="selected" <%}%>>5단계</option>
                                </select>
                                <% } else { %> <select name="c_searchType" class="dropdown">
                                        <option value="" selected="selected">노출여부</option>
                                        <option value="0" <%if(c_searchType=="0"){%> selected="selected" <%}%>>노출</option>
                                    <option value="1" <%if(c_searchType=="1"){%> selected="selected" <%}%>>비노출</option>
                                </select>
                                <%}%> <input class="btn btn-block btn-outline-success" type="button" id="searchAction"
                                            value="검색" />
                                </div>
                                <table id="exampleTable" class="table userTable table-responsive-sm table-hover">
                                    <colgroup>
                                        <col width="5%" />
                                        <col width="20%" />
                                        <col width="35%" />
                                        <col width="10%" />
                                        <col width="10%" />
                                        <col width="10%" />
                                    </colgroup>
                                    <thead>
                                        <tr>
                                            <th>번호</th>
                                            <!-- <th>이미지</th> -->
                                            <th>종류</th>
                                            <th>설명글</th>

                                            <% if(certiDivision == 0) {%> 
                                            <th>포인트</th>
                                            <th>단계</th>
                                            <% }else{ %>
                                            <th>권한</th>
                                            <th>기간</th>
                                            <% } %>
                                            <th>노출여부</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% if(results.length > 0) { %>
                                        <% for(var i = (page * page_num) - page_num; i < (page * page_num); i++) { 
                                                        if(i > length){
                                                        i++;
                                                        } else { %>
                                        <tr
                                            onclick="location.href='/admin/m_certification/selectOne?certiDivision=<%=certiDivision%>&certiTitleId=<%=results[i].certiTitleId%>&page=<%=page%><%= keepSearch %>'">
                                            <td><%= i + 1 %></td>
                                            <td><%=results[i].certiTitle%></td>
                                            <td><%=results[i].certiDetail %></td>
                                            <!--단계/권한-->
                                            <% if(results[i].certiDivision == 0) {%>
                                            <td><%=results[i].certiPoint%> 점</td>
                                            <td><%=results[i].certiDiff%> 단계</td>
                                            <% }else{ %>
                                            <td><%=results[i].certiAuth%></td>
                                            <% } %>
                                            <!--기간-->
                                            <% if(results[i].certiDivision == 1) {%>
                                            <td><%=results[i].certiStartDatefmt%> ~
                                                <br><%=results[i].certiEndDatefmt%></td>
                                            <% } %>
                                            <!--노출여부-->
                                            <% if(results[i].certiShow == 0) {%>
                                            <td>O</td>
                                            <% }else{ %>
                                            <td>X</td>
                                            <% } %>
                                        </tr>
                                        <% } %>
                                        <% } %>
                                        <% } else { %>
                                        <tr>
                                            <td colspan="6">
                                                등록된 목록이 없습니다.
                                            </td>
                                        </tr>
                                        <% } %>
                                    </tbody>
                                </table>
                                <div class="mt_20">
                                    <% if(sessionComId == 11) { %>
                                    <p class="float_r">
                                        <input id="enrollAction" class="btn btn-block btn-outline-success" type="button"
                                            onclick="enroll()" value="등록" />
                                    </p>
                                    <% } %>
                                    <% if(results.length > 0) { %>
                                    <div class="paging" id="page_navi">
                                        <ul class="pagination customPaging">
                                            <li> <a href="/admin/m_certification/certiAll?certiDivision=<%= certiDivision %>&page=1<%= keepSearch %>"
                                                    class="num">
                                                    <<</a> </li> <li> <a <%if((page==1)){%><%} else {%>
                                                            href="/admin/m_certification/certiAll?certiDivision=<%= certiDivision %>&page=<%= parseInt(page) - 1 %><%= keepSearch %>"
                                                            class="num" <% } %>>
                                                            <</a> </li>
                                                                <% for(var i = startPage; i < endPage; i++){  %>
                                                                <li class="paging_on">
                                                                <a href="/admin/m_certification/certiAll?certiDivision=<%= certiDivision %>&page=<%= i + 1 %><%= keepSearch %>"
                                                                    <%if(page==i+1){%>class="selected"
                                                                    <%}%> class="num"><%= i + 1 %></a> </li> <% } %>
                                                                    <li> <a <%if(page>last-1){%><%} else {%>
                                                                        href="/admin/m_certification/certiAll?certiDivision=<%= certiDivision %>&page=<%= parseInt(page) + 1 %><%= keepSearch %>"
                                                                        class="num" <% } %>>></a></li>
                                            <li><a href="/admin/m_certification/certiAll?certiDivision=<%= certiDivision %>&page=<%= last %><%= keepSearch %>"
                                                    class="num">>></a></li>
                                        </ul>
                                    </div>
                                    <% } %>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<script>
    const formObj = $("form[name='certiForm']");
    $(document).ready(function () {
        //검색
        $("#searchAction").on("click", function () {
            formObj.attr("action", "certiAll");
            formObj.attr("method", "get");
            formObj.submit();
        })

        //쿼리스트링 페이지
        function getUrlParams() {
            var params = {};
            window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (str, key, value) {
                params[key] = value;
            });
            return params;
        }
        var param = getUrlParams();
        var page = document.getElementById("page");
        page.value = param.page;
    });

    //등록
    function enroll() {
        formObj.attr("action", "certiWritForm");
        formObj.attr("method", "get");
        formObj.submit();
    }

    var certiDivi = document.getElementById("certiDivision").value

    if(certiDivi == 0){
    // 레이아웃 adminNav 해당 탭에 접근했을때 펼쳐주기 '[2] = 탄소실천관리'
    var navDropdown = document.getElementsByClassName("nav-dropdown");
        navDropdown[2].className += 'open';
    } else if(certiDivi == 1){
        // 레이아웃 adminNav 해당 탭에 접근했을때 펼쳐주기 '[3] = 챌린지관리'
        var navDropdown = document.getElementsByClassName("nav-dropdown");
            navDropdown[3].className += 'open';        
    }
</script>